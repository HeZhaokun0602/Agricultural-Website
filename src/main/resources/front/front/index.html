<!-- 首页 -->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>首页</title>
		<link rel="stylesheet" href="./layui/css/layui.css">
		<link rel="stylesheet" href="./xznstatic/css/common.css"/>
		<link rel="stylesheet" href="./xznstatic/css/style.css"/>
		<link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
	</head>
	<style type="text/css">
		html, body {
			height: 100%;
		}
		#iframe {
			width: 100%;
			margin-top: 110px;
			padding-top: 50px;
		}
		#header {
			height: auto;
			background: #fff;
			border-bottom: 0;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
		}

		#header .nav-top {
			display: flex;
			align-items: center;
			padding: 0 20px;
			font-size: 16px;
			color: #2a8a15;
			box-sizing: border-box;
			height: 90px;
			background-color: #1c7430;
			box-shadow: 0px 0px 0px #f9906f;
			justify-content: space-between;
			position: relative;
		}

		#header .nav-top-img {
			width: 150px;
			height: 100px;
			padding: 0;
			margin: 0;
			border-radius: 5px;
			border-width: 0;
			border-style: solid;
			border-color: rgba(0,0,0,.3);
			box-shadow: 0 0 0px ;
		}

		#header .nav-top-title {
			line-height: 40px;
			font-size: 28px;
			padding: 0 10px;
			margin: 0 10px;
			border-radius: 6px;
			border-width: 0;
			border-style: solid;
			border-color: rgba(0,0,0,.3);
			box-shadow: 0 0 0px rgba(0,0,0,.3);
			font-weight: bold;

			background-image: -webkit-linear-gradient(left,#e9a5a5,#b8c1c0 10%,#65c0e0 20%,#aea2db 30%,#81c1d9 40%,#e9a5a5 50%,#b8c1c0 60%,#65c0e0 70%,#aea2db 80%,#81c1d9 90%,#e9a5a5);
			color: transparent;
			-webkit-background-clip: text;
			background-size: 200% 100%;
			animation: a 5s infinite linear;
		}
		@keyframes a {
			0%{
				background-position: 0 0;
			}
			100%{
				background-position: -100% 0;
			}
		}

		#header .nav-top-tel {
			line-height: 40px;
			font-size: 16px;
			color: rgba(240, 240, 244, 1);
			padding: 0 10px;
			margin: 0;
			border-radius: 6px;
			border-width: 0;
			border-style: solid;
			border-color: rgba(0,0,0,.3);
			box-shadow: 0 0 0px rgba(0,0,0,.3);
		}

		#header .navs {
			display: flex;
			padding: 0 20px;
			align-items: center;
			box-sizing: border-box;
			height: 70px;
			background-color: #2a8a15;
			box-shadow: 0 1px 6px rgba(0,0,0,0);
			justify-content: center;
		}
		#header .navs .title {
			width: auto;
			line-height: 40px;
			font-size: 16px;
			color: #333;
			padding: 0 10px;
			margin: 0 5px;
			border-radius: 6px;
			border-width: 0;
			border-style: solid;
			border-color: rgba(0,0,0,.3);
			box-shadow: 0 0 6px rgba(0,0,0,0);
		}
		#header .navs li {
			display: inline-block;
			width: auto;
			line-height: 70px;
			padding: 0 10px;
			margin: 0 0px;

			font-size: 20px;
			font-weight: bold;
			border-radius: 0px;
			border-width: 0px;
			border-style: solid;
			border-color: rgba(0, 0, 0, 0);
			background-color: rgba(194, 204, 208, 0);
			box-shadow: 0 0 0px ;
			text-align: center;
			background-image: -webkit-linear-gradient(left,#e9a5a5,#b8c1c0 10%,#65c0e0 20%,#aea2db 30%,#81c1d9 40%,#e9a5a5 50%,#b8c1c0 60%,#65c0e0 70%,#aea2db 80%,#81c1d9 90%,#e9a5a5);
			color: transparent;
			-webkit-background-clip: text;
			background-size: 200% 100%;
			animation: a 5s infinite linear;
		}
		#header .navs li a{
			color: inherit;
		}
		#header .navs li.current a{
			color: inherit;
		}
		#header .navs li a:hover{
			color: inherit;
		}
		#header .navs li.current {
			color: rgba(255, 255, 255, 1);
			font-size: 20px;
			border-radius: 0px;
			border-width: 1px;
			border-style: solid;
			border-color: rgba(135, 206, 250, 1);
			background-color: rgba(135, 206, 250, 1);
			box-shadow: 0px 0px 0px #1685a9;
		}
		#header .navs li:hover {
			color: rgba(255, 255, 255, 1);
			font-size: 20px;
			border-radius: 0px;
			border-width: 0px;
			border-style: solid;
			border-color: rgba(135, 206, 250, 1);
			background-color: rgba(135, 206, 250, 1);
			box-shadow: 0 0 0px ;
		}
		.btn-box{
			position: absolute;
			top:5px;
			right:100px;
			z-index:999;
			display: flex;
		}
		.btn-box div{
			width:90px;
			height:40px;
			background: rgba(255, 255,255, 0.7);
			margin:5px;
			line-height: 40px;
			text-align: center;
			font-size: 14px;
			border-radius: 5px;
			cursor:pointer;
		}
		.btn-box div:hover{
			background: #fff;
		}
		.bg{
			width:100%;
			height:100%;
			transition:all 1s ease-in-out;
		}
		.light .bg{
			background-color: #c3e6cb;
		}
		.dark .bg{
			background-color: #1b1e21;
		}
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #333;
        }

        #modal-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 5px;
        }

        /* 按钮样式 */
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            position: relative;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* 加载动画 */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none; /* 默认隐藏 */
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
	</style>
	<body>
		<!-- start 顶部导航栏 -->
		<div id="header">
			<div v-if='true' class="nav-top">
			  <img v-if='false' class="nav-top-img" src='http://codegen.caihongy.cn/20210116/19006e072b0f4e5eb28ec9d519c5c841.png'>
			  <div v-if="true" class="nav-top-title">农创未来、农梦行动</div>
			  <div class="btn-box">
                  <div style="width:1000px;height:32px;float: right;background: rgba(0,0,0,0);color: yellow">
                  <input type="file" id="image-input" accept="image/*">
                  <button id="process-button" onclick="uploadImage()">
                      <span id="button-text">Upload and Process</span>
                      <div id="loader" class="loader"></div>
                  </button>
                  <!-- 模态框 -->
                  <div id="image-modal" class="modal" style="width:100%;height:100%;background: rgba(0,0,0,0)">
                      <div class="modal-content" style="width:800px;height:600px;background: rgba(255,255,255,0.7);cursor: default">
                          <span class="close" onclick="closeModal()">&times;</span>
                          <h2>Processed Image</h2>
                          <img id="modal-image" src="" alt="Processed Image">
                      </div>
                  </div>
                  </div>
				  <div onclick="change('light')">
					  <div style="width:32px;height:32px;float: left;background: rgba(0,0,0,0)">
						  <svg t="1711380343318" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="966" width="32" height="32" ><path d="M240.544 512.064a271.072 271.072 0 1 0 271.072-270.976 271.04 271.04 0 0 0-270.976 270.976z" fill="#EDA915" p-id="967"></path><path d="M511.712 163.424a22.4 22.4 0 0 1-22.4-22.4v-54.4a22.4 22.4 0 1 1 44.8 0v54.4a22.4 22.4 0 0 1-22.4 22.4z m-204.48 66.208a22.656 22.656 0 0 1-30.976-4.8l-32-44.32a22.144 22.144 0 0 1 35.776-26.144l32 44.32a22.592 22.592 0 0 1-4.64 30.944zM180.16 404.224a22.208 22.208 0 0 1-27.776 14.4l-51.776-17.088a22.112 22.112 0 0 1 13.344-42.176l51.776 17.088a21.984 21.984 0 0 1 14.432 27.776z m0 215.168a21.984 21.984 0 0 1-14.4 27.776l-51.776 17.088a22.112 22.112 0 0 1-13.344-42.176l51.776-17.088a22.88 22.88 0 0 1 27.744 14.368z m126.528 174.592a22.176 22.176 0 0 1 4.8 30.976l-32 44.32a22.176 22.176 0 1 1-35.776-26.176l32-44.32a22.752 22.752 0 0 1 31.008-4.832z m205.024 66.72a22.4 22.4 0 0 1 22.4 22.4v54.4a22.4 22.4 0 0 1-44.8 0v-54.4a22.912 22.912 0 0 1 22.4-22.432z m205.024-66.72a22.656 22.656 0 0 1 30.976 4.8l32 44.32a22.176 22.176 0 1 1-35.776 26.176l-32-44.32a22.656 22.656 0 0 1 4.8-31.008z m127.072-174.048a22.208 22.208 0 0 1 27.776-14.4l51.776 17.088a22.112 22.112 0 1 1-13.344 42.176l-51.776-17.088a21.376 21.376 0 0 1-14.432-27.808z m0-215.68a21.984 21.984 0 0 1 14.4-27.776l51.776-17.088a22.112 22.112 0 0 1 13.344 42.176l-51.776 17.088a21.984 21.984 0 0 1-27.744-14.432z m-127.072-174.592a22.176 22.176 0 0 1-4.8-30.976l32-44.32a22.144 22.144 0 1 1 35.776 26.144l-32 44.32a21.632 21.632 0 0 1-30.976 4.8z" fill="#EDA915" p-id="968"></path></svg>
					  </div>
					  <div style="width:30px;height:32px;float: left;line-height: 32px;background:rgba(0,0,0,0);margin:5px 0">
						  <i class="fa fa-sun-o" aria-hidden="true">白天</i>
					  </div>
				  </div>
				  <div onclick="change('dark')">
					  <div style="width:32px;height:32px;float: left;background: rgba(0,0,0,0)">
						  <svg t="1711381714348" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="966" width="32" height="32"><path d="M714.496 597.632a262.912 262.912 0 0 1-262.848-262.848 273.184 273.184 0 0 1 13.088-82.656A262.656 262.656 0 1 0 768 591.68a220.448 220.448 0 0 1-53.536 5.952z" fill="#EDA915" p-id="967"></path></svg>
					  </div>
					  <div style="width:30px;height:32px;float: left;line-height: 32px;background:rgba(0,0,0,0);margin:5px 0">
						  <i class="fa fa-sun-o" aria-hidden="true">黑夜</i>
					  </div>
				  </div>
			  </div>
			</div>
		    <div class="navs">
		    	<!-- <div class="logo" style="font-size: 20px;top: 32px;color: #fff;font-weight: bold;margin-left: -200px;width: 240px;" v-text="projectName"></div> -->
				<div class="title" v-if="false" v-text="projectName"></div>
				<div class="list">
					<ul>
						<li class='current'><a href="javascript:navPage('./pages/home/home.html')" class="menumain"><i v-if="false" class="layui-icon layui-icon-home"></i>首页</a></li>
						<li v-for="(item,index) in indexNav" v-bind:key="index"><a :href="'javascript:navPage(\''+item.url+'\')'" class="menumain" style="cursor: pointer;"><i v-if="false" class="layui-icon" :class="iconArr[index]"></i>{{item.name}}</a></li>
						<li><a href="javascript:centerPage();" class="menumain"><i v-if="false" class="layui-icon layui-icon-username"></i>个人中心</a></li>
						<li v-if="cartFlag"><a href="javascript:navPage('./pages/shop-cart/list.html')" class="menumain"><i v-if="false" class="layui-icon">&#xe657;</i>购物车</a></li>
					</ul>
				</div>
		    </div>
		</div>
		<!-- end 顶部导航栏 -->
        <div class="light" id="container">
			<div class="bg">
				<iframe src="./pages/home/home.html" id="iframe" frameborder="0" scrolling="no" width="100%" onload="changeFrameHeight"></iframe>
			</div>
		</div>
	  <div id="tabbar" v-if="true" class="tabbar" :style='{"padding":"20px 0","boxShadow":"0 0 0px rgba(255,0,0,.8)","margin":"10px 0 0 0","borderColor":"rgba(0,0,0,.3)","backgroundColor":"rgba(135, 206, 250, 1)","borderRadius":"0","borderWidth":"0","borderStyle":"solid"}' style="position: relative;z-index: 999;">
          <img v-if='false' :style='{"boxShadow":"0 0 6px rgba(255,0,0,.8)","margin":"0 auto","borderColor":"rgba(0,0,0,.3)","borderRadius":"100%","borderWidth":"1px","width":"44px","borderStyle":"solid","height":"44px"}' style='display: block;' src='http://codegen.caihongy.cn/20201024/ed5e326ca66f403aa3197b5fbb4ec733.jpg' />
          <div :style='{"padding":"0 10px","boxShadow":"0 0 0px rgba(255,0,0,.8)","margin":"10px auto","borderColor":"rgba(0,0,0,1)","backgroundColor":"#000","color":"#fff","textAlign":"center","borderRadius":"0","borderWidth":"0","width":"100%","lineHeight":"32px","fontSize":"14px","borderStyle":"solid"}' class="company"></div>
          <div :style='{"padding":"0 10px","boxShadow":"0 0 6px rgba(255,0,0,0)","margin":"10px auto","borderColor":"rgba(0,0,0,1)","backgroundColor":"#000","color":"#fff","textAlign":"center","borderRadius":"0","borderWidth":"0","width":"100%","lineHeight":"32px","fontSize":"14px","borderStyle":"solid"}' class="record"></div>
          <div :style='{"padding":"0 10px","boxShadow":"0 0 0px rgba(255,0,0,0)","margin":"10px auto 30px auto","borderColor":"rgba(255,255,255,1)","backgroundColor":"rgba(160, 67, 26, 1)","color":"#fff","textAlign":"center","borderRadius":"0","borderWidth":"0px 0","width":"40%","lineHeight":"32px","fontSize":"15px","borderStyle":"solid"}' class="desc"></div>
      </div>
		<script src="./xznstatic/js/jquery-1.11.3.min.js"></script>
		<script src="./layui/layui.js"></script>
		<script src="./js/vue.js"></script>
		<script src="./js/config.js"></script>
		<script>
      var vue1 = new Vue({el: '#tabbar'})
      var vue = new Vue({
          el: '#header',
          data: {
              iconArr: ['layui-icon-gift','layui-icon-email','layui-icon-logout','layui-icon-transfer','layui-icon-slider','layui-icon-print','layui-icon-cols','layui-icon-snowflake','layui-icon-note','layui-icon-flag','layui-icon-theme','layui-icon-website','layui-icon-console','layui-icon-face-surprised','layui-icon-template-1','layui-icon-app','layui-icon-read','layui-icon-component','layui-icon-file-b','layui-icon-unlink','layui-icon-tabs','layui-icon-form','layui-icon-chat'],
              indexNav: indexNav,
              cartFlag: cartFlag,
              adminurl: adminurl,
              chatFlag: chatFlag,
              projectName: projectName,
          },
          mounted: function() {
              this.bindClickOnLi();
          },
          created() {
              this.iconArr.sort(()=>{
                  return (0.5-Math.random())
              })
          },
          methods: {
              jump(url) {
                  jump(url)
              },
              bindClickOnLi() {
                  let list = document.getElementsByTagName("li");
                  for(var i = 0;i<list.length;i++){
                      list[i].onclick = function(){
                          $(this).addClass("current").siblings().removeClass("current");
                      }
                  }
              }
          }
      });
      layui.use(['element','layer'], function() {
          var element = layui.element;
          var layer = layui.layer;
      });
      // 导航栏跳转
      function navPage(url) {
          localStorage.setItem('iframeUrl', url);
          document.getElementById('iframe').src = url;
      }
      // 跳转到个人中心也
      function centerPage() {
          var userTable = localStorage.getItem('userTable');
          if (userTable) {
              localStorage.setItem('iframeUrl', './pages/' + userTable + '/center.html');
              document.getElementById('iframe').src = './pages/' + userTable + '/center.html';
          } else {
              window.location.href = './pages/login/login.html'
          }
      }
      var iframeUrl = localStorage.getItem('iframeUrl');
      document.getElementById('iframe').src = iframeUrl  || './pages/home/home.html';
      setInterval(function(){   //定时调整iframe的高度
          changeFrameHeight();
      },200)
      function changeFrameHeight() {
          var iframe = document.getElementById('iframe');
          // iframe.height = 'auto';
          if (iframe) {
              var iframeWin = iframe.contentWindow || iframe.contentDocument.parentWindow;  //获取 iframe 的窗口对象或兼容性处理
              if (iframeWin.document.body) {
                  iframe.height = iframeWin.document.body.scrollHeight;
              }
          }
      };
      window.onresize = function() {
          changeFrameHeight();
      }
	  function change(str){
		  document.getElementById("container").setAttribute("class",str);
	  }
      //新增功能
      async function uploadImage() {
          const fileInput = document.getElementById('image-input');
          const file = fileInput.files[0];
          const button = document.getElementById('process-button');
          const buttonText = document.getElementById('button-text');
          const loader = document.getElementById('loader');

          if (!file) {
              alert('Please select an image file.');
              return;
          }

          // 禁用按钮并显示加载动画
          button.disabled = true;
          buttonText.style.display = 'none';
          loader.style.display = 'block';
          loader.style.width = '20px'
          loader.style.height = '20px'
          loader.style.cursor = 'not-allowed'
          loader.style.border = '5px'

          const formData = new FormData();
          formData.append('file', file);

          try {
              const response = await fetch('http://10.16.0.244:5000/process', {
                  method: 'POST',
                  body: formData
              });

              if (!response.ok) {
                  const errorData = await response.json();
                  throw new Error(errorData.error || 'Failed to process image');
              }

              const data = await response.json();

              // 获取 Base64 图像数据
              const base64Image = data.image_base64;

              // 显示模态框
              const modal = document.getElementById('image-modal');
              const modalImage = document.getElementById('modal-image');
              modalImage.src = `data:image/png;base64,${base64Image}`;
              modal.style.display = 'flex';
          } catch (error) {
              console.error('Error:', error);
              alert(`An error occurred: ${error.message}`);
          } finally {
              // 恢复按钮状态
              button.disabled = false;
              buttonText.style.display = 'block';
              loader.style.display = 'none';
          }
      }

      // 关闭模态框
      function closeModal() {
          const modal = document.getElementById('image-modal');
          modal.style.display = 'none';
      }

      // 点击模态框外部关闭
      window.onclick = function (event) {
          const modal = document.getElementById('image-modal');
          if (event.target === modal) {
              modal.style.display = 'none';
          }
      };
		</script>
	</body>
</html>
